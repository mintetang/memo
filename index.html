<!DOCTYPE html>
<html>
<head>
  <title>Upload LocalStorage to Google Drive</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <button id="authorize_button">Authorize</button>
  <button id="upload_button" disabled>Upload LocalStorage to Drive</button>

  <script>
    const CLIENT_ID = "273160542369-ttt03gmv0iio70vek53dqrqcfs9rt1a6.apps.googleusercontent.com";
    const API_KEY = "AIzaSyDZkfoh01VUEwX_uK3xn3jVvMLssdPCqoo";
    const SCOPES = "https://www.googleapis.com/auth/drive.file";

    function gapiLoaded() {
      gapi.load("client:auth2", initClient);
    }

    function initClient() {
      gapi.client
        .init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          scope: SCOPES,
          discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
        })
        .then(() => {
          document.getElementById("authorize_button").onclick = handleAuthClick;
          document.getElementById("upload_button").onclick = uploadLocalStorage;
        });
    }

    function handleAuthClick() {
      gapi.auth2.getAuthInstance().signIn().then(() => {
        document.getElementById("upload_button").disabled = false;
      });
    }

    async function uploadLocalStorage() {
      // Convert LocalStorage contents to JSON
      const localData = JSON.stringify(localStorage);
      const blob = new Blob([localData], { type: "application/json" });
      const metadata = {
        name: "localStorageBackup.json",
        mimeType: "application/json",
      };

      const accessToken = gapi.auth.getToken().access_token;

      const form = new FormData();
      form.append(
        "metadata",
        new Blob([JSON.stringify(metadata)], { type: "application/json" })
      );
      form.append("file", blob);

      const res = await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart", {
        method: "POST",
        headers: new Headers({ Authorization: "Bearer " + accessToken }),
        body: form,
      });

      const data = await res.json();
      console.log("âœ… File uploaded:", data);
      alert("LocalStorage uploaded to Google Drive!");
    }

    // Load GAPI
    gapiLoaded();
  </script>
</body>
</html>
